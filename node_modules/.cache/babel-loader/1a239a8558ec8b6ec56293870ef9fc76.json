{"ast":null,"code":"'use strict';\n\nvar _classCallCheck = require(\"/home/arjuna/Desktop/internship-project/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/home/arjuna/Desktop/internship-project/node_modules/@babel/runtime/helpers/createClass\");\n\nvar spawn = require('child_process').spawn;\n\nvar packageData = require('../../package.json');\n\nvar LeWindows = require('./le-windows');\n\nvar LeUnix = require('./le-unix');\n\nvar shared = require('../shared');\n/**\n * Generates a Transport object for Sendmail\n *\n * Possible options can be the following:\n *\n *  * **path** optional path to sendmail binary\n *  * **newline** either 'windows' or 'unix'\n *  * **args** an array of arguments for the sendmail binary\n *\n * @constructor\n * @param {Object} optional config parameter for Sendmail\n */\n\n\nvar SendmailTransport =\n/*#__PURE__*/\nfunction () {\n  function SendmailTransport(options) {\n    _classCallCheck(this, SendmailTransport);\n\n    options = options || {}; // use a reference to spawn for mocking purposes\n\n    this._spawn = spawn;\n    this.options = options || {};\n    this.name = 'Sendmail';\n    this.version = packageData.version;\n    this.path = 'sendmail';\n    this.args = false;\n    this.winbreak = false;\n    this.logger = shared.getLogger(this.options, {\n      component: this.options.component || 'sendmail'\n    });\n\n    if (options) {\n      if (typeof options === 'string') {\n        this.path = options;\n      } else if (typeof options === 'object') {\n        if (options.path) {\n          this.path = options.path;\n        }\n\n        if (Array.isArray(options.args)) {\n          this.args = options.args;\n        }\n\n        this.winbreak = ['win', 'windows', 'dos', '\\r\\n'].includes((options.newline || '').toString().toLowerCase());\n      }\n    }\n  }\n  /**\n   * <p>Compiles a mailcomposer message and forwards it to handler that sends it.</p>\n   *\n   * @param {Object} emailMessage MailComposer object\n   * @param {Function} callback Callback function to run when the sending is completed\n   */\n\n\n  _createClass(SendmailTransport, [{\n    key: \"send\",\n    value: function send(mail, done) {\n      var _this = this;\n\n      // Sendmail strips this header line by itself\n      mail.message.keepBcc = true;\n      var envelope = mail.data.envelope || mail.message.getEnvelope();\n      var messageId = mail.message.messageId();\n      var args;\n      var sendmail;\n      var returned;\n      var transform;\n\n      if (this.args) {\n        // force -i to keep single dots\n        args = ['-i'].concat(this.args).concat(envelope.to);\n      } else {\n        args = ['-i'].concat(envelope.from ? ['-f', envelope.from] : []).concat(envelope.to);\n      }\n\n      var callback = function callback(err) {\n        if (returned) {\n          // ignore any additional responses, already done\n          return;\n        }\n\n        returned = true;\n\n        if (typeof done === 'function') {\n          if (err) {\n            return done(err);\n          } else {\n            return done(null, {\n              envelope: mail.data.envelope || mail.message.getEnvelope(),\n              messageId: messageId,\n              response: 'Messages queued for delivery'\n            });\n          }\n        }\n      };\n\n      try {\n        sendmail = this._spawn(this.path, args);\n      } catch (E) {\n        this.logger.error({\n          err: E,\n          tnx: 'spawn',\n          messageId: messageId\n        }, 'Error occurred while spawning sendmail. %s', E.message);\n        return callback(E);\n      }\n\n      if (sendmail) {\n        sendmail.on('error', function (err) {\n          _this.logger.error({\n            err: err,\n            tnx: 'spawn',\n            messageId: messageId\n          }, 'Error occurred when sending message %s. %s', messageId, err.message);\n\n          callback(err);\n        });\n        sendmail.once('exit', function (code) {\n          if (!code) {\n            return callback();\n          }\n\n          var err;\n\n          if (code === 127) {\n            err = new Error('Sendmail command not found, process exited with code ' + code);\n          } else {\n            err = new Error('Sendmail exited with code ' + code);\n          }\n\n          _this.logger.error({\n            err: err,\n            tnx: 'stdin',\n            messageId: messageId\n          }, 'Error sending message %s to sendmail. %s', messageId, err.message);\n\n          callback(err);\n        });\n        sendmail.once('close', callback);\n        sendmail.stdin.on('error', function (err) {\n          _this.logger.error({\n            err: err,\n            tnx: 'stdin',\n            messageId: messageId\n          }, 'Error occurred when piping message %s to sendmail. %s', messageId, err.message);\n\n          callback(err);\n        });\n        var recipients = [].concat(envelope.to || []);\n\n        if (recipients.length > 3) {\n          recipients.push('...and ' + recipients.splice(2).length + ' more');\n        }\n\n        this.logger.info({\n          tnx: 'send',\n          messageId: messageId\n        }, 'Sending message %s to <%s>', messageId, recipients.join(', '));\n        transform = this.winbreak ? new LeWindows() : new LeUnix();\n        var sourceStream = mail.message.createReadStream();\n        transform.once('error', function (err) {\n          _this.logger.error({\n            err: err,\n            tnx: 'stdin',\n            messageId: messageId\n          }, 'Error occurred when generating message %s. %s', messageId, err.message);\n\n          sendmail.kill('SIGINT'); // do not deliver the message\n\n          callback(err);\n        });\n        sourceStream.once('error', function (err) {\n          return transform.emit('error', err);\n        });\n        sourceStream.pipe(transform).pipe(sendmail.stdin);\n      } else {\n        return callback(new Error('sendmail was not found'));\n      }\n    }\n  }]);\n\n  return SendmailTransport;\n}();\n\nmodule.exports = SendmailTransport;","map":{"version":3,"sources":["/home/arjuna/Desktop/internship-project/node_modules/nodemailer/lib/sendmail-transport/index.js"],"names":["spawn","require","packageData","LeWindows","LeUnix","shared","SendmailTransport","options","_spawn","name","version","path","args","winbreak","logger","getLogger","component","Array","isArray","includes","newline","toString","toLowerCase","mail","done","message","keepBcc","envelope","data","getEnvelope","messageId","sendmail","returned","transform","concat","to","from","callback","err","response","E","error","tnx","on","once","code","Error","stdin","recipients","length","push","splice","info","join","sourceStream","createReadStream","kill","emit","pipe","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nconst spawn = require('child_process').spawn;\nconst packageData = require('../../package.json');\nconst LeWindows = require('./le-windows');\nconst LeUnix = require('./le-unix');\nconst shared = require('../shared');\n\n/**\n * Generates a Transport object for Sendmail\n *\n * Possible options can be the following:\n *\n *  * **path** optional path to sendmail binary\n *  * **newline** either 'windows' or 'unix'\n *  * **args** an array of arguments for the sendmail binary\n *\n * @constructor\n * @param {Object} optional config parameter for Sendmail\n */\nclass SendmailTransport {\n    constructor(options) {\n        options = options || {};\n\n        // use a reference to spawn for mocking purposes\n        this._spawn = spawn;\n\n        this.options = options || {};\n\n        this.name = 'Sendmail';\n        this.version = packageData.version;\n\n        this.path = 'sendmail';\n        this.args = false;\n        this.winbreak = false;\n\n        this.logger = shared.getLogger(this.options, {\n            component: this.options.component || 'sendmail'\n        });\n\n        if (options) {\n            if (typeof options === 'string') {\n                this.path = options;\n            } else if (typeof options === 'object') {\n                if (options.path) {\n                    this.path = options.path;\n                }\n                if (Array.isArray(options.args)) {\n                    this.args = options.args;\n                }\n                this.winbreak = ['win', 'windows', 'dos', '\\r\\n'].includes((options.newline || '').toString().toLowerCase());\n            }\n        }\n    }\n\n    /**\n     * <p>Compiles a mailcomposer message and forwards it to handler that sends it.</p>\n     *\n     * @param {Object} emailMessage MailComposer object\n     * @param {Function} callback Callback function to run when the sending is completed\n     */\n    send(mail, done) {\n        // Sendmail strips this header line by itself\n        mail.message.keepBcc = true;\n\n        let envelope = mail.data.envelope || mail.message.getEnvelope();\n        let messageId = mail.message.messageId();\n        let args;\n        let sendmail;\n        let returned;\n        let transform;\n\n        if (this.args) {\n            // force -i to keep single dots\n            args = ['-i'].concat(this.args).concat(envelope.to);\n        } else {\n            args = ['-i'].concat(envelope.from ? ['-f', envelope.from] : []).concat(envelope.to);\n        }\n\n        let callback = err => {\n            if (returned) {\n                // ignore any additional responses, already done\n                return;\n            }\n            returned = true;\n            if (typeof done === 'function') {\n                if (err) {\n                    return done(err);\n                } else {\n                    return done(null, {\n                        envelope: mail.data.envelope || mail.message.getEnvelope(),\n                        messageId,\n                        response: 'Messages queued for delivery'\n                    });\n                }\n            }\n        };\n\n        try {\n            sendmail = this._spawn(this.path, args);\n        } catch (E) {\n            this.logger.error(\n                {\n                    err: E,\n                    tnx: 'spawn',\n                    messageId\n                },\n                'Error occurred while spawning sendmail. %s',\n                E.message\n            );\n            return callback(E);\n        }\n\n        if (sendmail) {\n            sendmail.on('error', err => {\n                this.logger.error(\n                    {\n                        err,\n                        tnx: 'spawn',\n                        messageId\n                    },\n                    'Error occurred when sending message %s. %s',\n                    messageId,\n                    err.message\n                );\n                callback(err);\n            });\n\n            sendmail.once('exit', code => {\n                if (!code) {\n                    return callback();\n                }\n                let err;\n                if (code === 127) {\n                    err = new Error('Sendmail command not found, process exited with code ' + code);\n                } else {\n                    err = new Error('Sendmail exited with code ' + code);\n                }\n\n                this.logger.error(\n                    {\n                        err,\n                        tnx: 'stdin',\n                        messageId\n                    },\n                    'Error sending message %s to sendmail. %s',\n                    messageId,\n                    err.message\n                );\n                callback(err);\n            });\n            sendmail.once('close', callback);\n\n            sendmail.stdin.on('error', err => {\n                this.logger.error(\n                    {\n                        err,\n                        tnx: 'stdin',\n                        messageId\n                    },\n                    'Error occurred when piping message %s to sendmail. %s',\n                    messageId,\n                    err.message\n                );\n                callback(err);\n            });\n\n            let recipients = [].concat(envelope.to || []);\n            if (recipients.length > 3) {\n                recipients.push('...and ' + recipients.splice(2).length + ' more');\n            }\n            this.logger.info(\n                {\n                    tnx: 'send',\n                    messageId\n                },\n                'Sending message %s to <%s>',\n                messageId,\n                recipients.join(', ')\n            );\n\n            transform = this.winbreak ? new LeWindows() : new LeUnix();\n            let sourceStream = mail.message.createReadStream();\n\n            transform.once('error', err => {\n                this.logger.error(\n                    {\n                        err,\n                        tnx: 'stdin',\n                        messageId\n                    },\n                    'Error occurred when generating message %s. %s',\n                    messageId,\n                    err.message\n                );\n                sendmail.kill('SIGINT'); // do not deliver the message\n                callback(err);\n            });\n\n            sourceStream.once('error', err => transform.emit('error', err));\n            sourceStream.pipe(transform).pipe(sendmail.stdin);\n        } else {\n            return callback(new Error('sendmail was not found'));\n        }\n    }\n}\n\nmodule.exports = SendmailTransport;\n"]},"metadata":{},"sourceType":"script"}